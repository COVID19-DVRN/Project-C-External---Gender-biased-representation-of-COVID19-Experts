import spacyimport jsonimport pandas as pd## for standford ner taggerfrom nltk.tag import StanfordNERTaggerfrom nltk.tokenize import word_tokenize# %%## the setting up of the stanfrod ner tagger code is borrowed from ## https://pythonprogramming.net/named-entity-recognition-stanford-ner-tagger/st = StanfordNERTagger('../untracked/stanford-ner/classifiers/english.all.3class.distsim.crf.ser.gz',					   '../untracked/stanford-ner/stanford-ner.jar',					   encoding='utf-8')r=st.tag('Rami Eid is studying at Stony Brook University in NY'.split())print(r) ## Using answer from this link we get the multi term ner tagger from stanford ner## https://stackoverflow.com/questions/30664677/extract-list-of-persons-and-organizations-using-stanford-ner-tagger-in-nltk# %%# Load English tokenizer, tagger, parser, NER and word vectorsnlp = spacy.load("en_core_web_sm")# %%def get_continuous_chunks(tagged_sent):    continuous_chunk = []    current_chunk = []    for token, tag in tagged_sent:        if tag != "O":            current_chunk.append((token, tag))        else:            if current_chunk: # if the current chunk is not empty                continuous_chunk.append(current_chunk)                current_chunk = []    # Flush the final current_chunk into the continuous_chunk, if any.    if current_chunk:        continuous_chunk.append(current_chunk)    return continuous_chunkdef get_all_entities_from_stanfor_ner(sentence,stanfor_ner_tagger = st):    ne_tagged_sent = st.tag(word_tokenize(sentence))    named_entities = get_continuous_chunks(ne_tagged_sent)    named_entities_str_tag = [(" ".join([token for token, tag in ne]), ne[0][1]) for ne in named_entities]    return named_entities_str_tagdef get_persons(text,model):    if model=="stanford":        person_names = [ent[0] for ent in get_all_entities_from_stanfor_ner(text) if ent[1]=="PERSON"]    elif model=="spacy":        doc = nlp(text)        person_names = [entity.text for entity in doc.ents if entity.label_=="PERSON"]    return person_names        # %%df_orig = pd.read_csv("../input/untracked/Coronavirus_20200101_20200409_clean_expert.csv")df = df_orig[["stories_id","url","Text","Expert_Mention_Sentence_List"]]df = df.set_index("stories_id")# %%def get_all_persons_from_whole_article():    passdef get_target_full_name_using_single_name_from_article():    pass# %%models = ["stanford","spacy"]for stories_id,sentence_lists in df.to_dict()["Expert_Mention_Sentence_List"].items():    print(stories_id, sentence_lists)    for sentence in eval(sentence_lists):        for model in models:            print(model)            for person_name in get_persons(sentence[0],model=model):                print("\t"+person_name)    input("Press Enter to continue...")# %%# #Couldn't detect the name## 1511515765 [['"There are lots of very smart people in this business, but very few of them are infectious disease experts," Cramer said, arguing that Thursday\'s run shouldn\'t have happened']]## Repeated news## 157,1545400665,1/31/2020 16:40,"11 questions about the Covid-19 coronavirus outbreak, answered",https://www.vox.com/2020/1/31/21113178/what-is-coronavirus-symptoms-travel-china-map?utm_source=facebook&utm_campaign=vox.social&utm_content=voxdotcom&utm_medium=social,en,False,"medicine and health, diseases and conditions, travel and vacations, viruses",104828,Vox,## 164,1511004242,1/31/2020 16:35,"8 questions about the coronavirus outbreak, answered",https://www.vox.com/2020/1/31/21113178/what-is-coronavirus-symptoms-travel-china-map## In some sentences we miss the name because it ended with something like "said dr."## 1510939280 [[', this is what is killing us,” said UC Riverside epidemiologist Brandon Brown'], ['Advertisement “Get your flu shot — take measures to prevent getting sick with the many things in this country we have to get sick from,” said Tufts Medical Center infectious disease specialist Dr'], ['To protect against the flu — or coronavirus, if that’s your concern — people should wash their hands frequently, sneeze or cough into the crook of their elbow and avoid contact with ill people, said Dartmouth College professor Dr']]    ## For some reason spacy is only detecting the names with Two parts Firstname Surname, but the ones with a single surname or even some of them with three part, it is missing## 1510576258 [['Stacie San Miguel, the director of medical services at the University of California, San Diego’s student health center, said students and others had been flocking to physicians for checkups']]## In this case stanford is working"""1510576258 [['Stacie San Miguel, the director of medical services at the University of California, San Diego’s student health center, said students and others had been flocking to physicians for checkups']]stanford	Stacie San Miguelspacy"""## Sometimes there are names which have dash separated last name, they are well recognized by spacy## 1510550623 [['People who are well should refrain from hoarding masks \'just in case\' they need it, as this may lead to a lack of masks in settings that really need it," said Annelies Wilder-Smith, a professor of emerging infectious diseases at the London School of Hygiene and Tropical Medicine'], ['"While we should take the outbreak seriously, we mustn\'t panic and behave in a manner that is disproportionate to the threat we are confronted with," said Wilder-Smith, who was a front-line clinician at Singapore\'s Tan Tock Seng Hospital during the severe acute respiratory syndrome outbreak in 2003'], ['As countries around the world guard against the viral outbreak, the scramble for face masks as a form of psychological aid is "completely understandable," said William Schaffner, an infectious diseases expert at the Vanderbilt University\'s Medical Center in Nashville, Tennessee']]## Annelies Wilder-Smith## Wilder-Smith## William Schaffner## False Positive of person recognition## 1510472231 [['Queensland Health chief officer Dr Jeannette Young on Thursday said she was concerned about everyone on the plane']]## Queensland Health## Jeannette Young## Stanford doesn't recognize Queensland health## WE are missing any name, but there is a "he says" term in the sentence## 1545436144 [['But the Centers for Disease Control has been proactive from the beginning, setting up protocols to screen travelers who are returning from China, and pushing out information to clinicians about how to be alert for the virus, he says']]## We are missing Dr Tedros Adhanom Ghebreyesus## 1510421385 [["Speaking to reporters, WHO Director-General Dr Tedros Adhanom Ghebreyesus said: 'The main reason for this declaration is not because of what is happening in China, but because of what is happening in other countries"], ['They all took Tiger Air flight TT566, landing on the Gold Coast about 8pm on Monday on a plane that carries up to 189 passengersQueensland Health chief officer Dr Jeannette Young on Thursday said she was concerned about everyone on the plane']]## Tiger Air## Jeannette Young"""stanford	Jeannette Youngspacy	Tiger Air	Jeannette Young"""## After adding Stanford most of the time stanford works better than spacy but this is one example where spacy is better:## 1512650660 [['Matthew Kennedy analyst at Renaissance Capital Gary Dushnitsky, associate professor of strategy and entrepreneurship at the London Business School, who has studied the role of corporations in venture investing, said some corporates invest in start-ups with an explicit goal of generating financial returns — with the belief that they are better at evaluating and nurturing start-ups and therefore should make superior returns'], ['Reena Aggarwal, a Georgetown University business professor and IPO expert said many of these investors are not flippers and do look at holdings on a longer-term basis']]##stanford##	Matthew Kennedy##spacy##	Matthew Kennedy##	Gary Dushnitsky"""1510456517 [['Additional resources from non-governmental organizations including Doctors Without Borders and charitable groups such as the Bill and Melinda Gates Foundation could be extremely useful for governments struggling to bring in medical teams and identify infected persons, Gostin said']]stanford	Bill	Gostinspacy	Bill	GostinPress Enter to continue...1511797507 [['“Alex has pushed to see if we can send some of our people there to not only help the Chinese but also get some information that would inform our strategies and response," said Fauci, the infectious disease doctor']]stanford	Alex	Faucispacy	Fauci"""##Sometimes surprisingly spacy detects soemthing that Stanfrod couldn't"""1510405065 [["Virologist and professor of microbiology and immunology at Columbia University Vincent Racaniello, PhD, spoke about the virus on Monday and said it differs from SARS in that it's spreading outside of the medical community"]]stanfordspacy	Vincent Racaniello"""## Spacy  doesn't detect the single name persons"""Press Enter to continue...1532063047 [['“This is the time for science, not rumors,” Dr Tedros said']]stanford	Tedrosspacy"""## Again stanford does better on single name stuffs"""1510291862 [['"The fact that such warm water was just now recorded by our team along a section of Thwaites grounding zone where we have known the glacier is melting suggests that it may be undergoing an unstoppable retreat that has huge implications for global sea-level rise," explains Holland, a professor at NYU\'s Courant Institute of Mathematical Sciences']]stanford	Hollandspacy"""